---
output: html_document
editor_options: 
  chunk_output_type: inline
---

# Explaining the Predictive Performance of Black Box Classification Models
## *Luis Torgo, Paulo Azevedo, Ines Areosa*

This page contains the code, data and resulting plots of the experiments in the paper: *Explaining the Predictive Performance of Black Box Classification Models*.

First, it is provided an explanation on how the full experiments can be reproduced, followed with an example of the EDP tool. 

Finally we provide a zip file with plots corresponding to all 18 data sets, not included in the paper due to space limitation.


## Requirements
[R](www.r-project.org) is required for reproducing the experiments. The following R extra packages, available on [CRAN](https://cran.r-project.org/web/packages/), are also needed:


* dplyr
* gridExtra
* reshape2
* RColorBrewer
* gtable
* ggplot2


## Usage

Tested on R 4.0.2

The full code and the data sets can be downloaded [here](code.zip). The resultant plots can be downloaded [here](plots.zip)


### Load Functions and Dataset

```{r, warning=FALSE}
## Loading functions required (as well as required packages)
source('Functions_ClassificationEDP.R')


## Loading Dataset
load("benchmarkWithPreds.Rdata")

```

### Run the Experiments for the Full Benchmark Dataset

```Rscript Calculate_results.R```

### An Example on How to Employ EDP Function


Choose a particular data set from the full benchmark. Here an example for "Adult". Column *Class* shows the true prediction, while *svm*, *randomForest*, *nnet* and *naiveBayes* show the predictions for each of the models, as described in the paper
```{r }

data_set <- DSOut[["Adult"]][complete.cases(DSOut[["Adult"]]),]

#Show part of dataset
head(data_set, n=10)
```

Choose which model is to be analysed and prepare the data. The last field, *details*, defines the information to present the error:

- "show_all" shows what was the model prediction versus the true prediction (when wrong)
- "reduced" shows only what category did the model fail to predict
```{r }
mod <- "svm"

db <- prep_data(data_set[,-which(names(data_set) %in% c("svm","randomForest", "nnet", "naiveBayes"))], data_set[, mod], "Class", details = "show_all") #First field should include entire dataset excepting model predictions; Second field should include the model predictions; third field should be the name of the predicted class
    
head(db, n=10)
```


Choose a predictor and calculate the EDP. Here is the example with a numeric ("capital.gain") and a categorical ("relationship").
There is an option for additional zoom in the error part, that can be added by including the condition, *zoom = TRUE*, as the example in the second EDP.
The numerical feature bins can be controlled one of the three features:

- nquant: Number of bins (of equal size)
- size: size of bins
- quantil_break: Breaks in terms of quantiles
- breaks: List of breaking points

```{r, results='hide', fig.keep='all'}
cep(db, "capital.gain")

cep(db, "relationship", zoom = TRUE)


```










